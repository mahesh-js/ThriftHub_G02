<!DOCTYPE html>
<html lang="en">
<head>
  <title>ThriftHub | Checkout</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="">
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700%7COpen+Sans:400,400i,600,700' rel='stylesheet'>
  <link rel="stylesheet" href="css/bootstrap.min.css" />
  <link rel="stylesheet" href="css/magnific-popup.css" />
  <link rel="stylesheet" href="css/font-icons.css" />
  <link rel="stylesheet" href="css/sliders.css" />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="shortcut icon" href="img/favicon.ico">
  <link rel="apple-touch-icon" href="img/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="72x72" href="img/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="114x114" href="img/apple-touch-icon-114x114.png">
  <!-- Jawi Font (Optional: Add a Jawi-specific font for rendering) -->
  <link href="https://fonts.googleapis.com/css2?family=Scheherazade&display=swap" rel="stylesheet">
</head>
<style>
  .jawi-text {
      font-family: 'Scheherazade', Arial, sans-serif;
      direction: rtl; /* Right-to-left for Jawi script */
    }
</style>
<body class="relative">
  <div class="loader-mask">
    <div class="loader">
      <div></div>
      <div></div>
    </div>
  </div>
  
  <main class="main-wrapper">
    <header class="nav-type-1">
      

      <div class="top-bar hidden-xs">
        <div class="container">
          <div class="top-bar-links flex-parent">
            <ul class="top-bar-currency-language">
              <li>
                Currency: <a href="#">MYR<i class="fa fa-angle-down"></i></a>
                <div class="currency-dropdown">
                  <ul>
                    <li><a href="#">MYR</a></li>
                    <li><a href="#">SGD</a></li>
                  </ul>
                </div>
              </li>
              <li class="language">
                Language: <a href="#" id="currentLanguage">ENG<i class="fa fa-angle-down"></i></a>
                <div class="language-dropdown">
                  <ul>
                    <li><a href="#" class="language-option" data-lang="en">English</a></li>
                    <li><a href="#" class="language-option" data-lang="ms">Malay</a></li>
                    <li><a href="#" class="language-option" data-lang="zh">Chinese (Simplified)</a></li>
                    <li><a href="#" class="language-option" data-lang="zh-TW">Chinese (Traditional)</a></li>
                    <li><a href="#" class="language-option" data-lang="ko">Korean</a></li>
                    <li><a href="#" class="language-option" data-lang="ja">Japanese</a></li>
                    <li><a href="#" class="language-option" data-lang="ms-Arab">Malay (Jawi)</a></li>
                    <li><a href="#" class="language-option" data-lang="ta">Tamil</a></li>
                  </ul>
                </div>
              </li>
            </ul>
            <ul class="top-bar-acc" style="margin-right: 38%;">
              Pre-Raya Sale: Enjoy Free Shipping! <a href="m-tops.html" style="color:darkgoldenrod;">Shop Now</a>
            </ul>
          </div>
        </div>
      </div>

      <nav class="navbar navbar-responsive-top">
        <div class="navigation" id="sticky-nav">
          <div class="container relative">
            <nav class="navbar navbar-static-top">
              <div class="navigation" id="sticky-nav">
                <div class="container relative">
                  <div class="row flex-parent">
                    <div class="nav-wrap flex-child" style="margin-left: -60px;">
                      <div class="collapse navbar-collapse text-left" id="navbar-collapse">
                        <ul class="nav navbar-nav">
                          <li class="dropdown">
                            <a href="#">Shop</a>
                            <i class="fa fa-angle-down dropdown-trigger"></i>
                            <ul class="dropdown-menu megamenu-wide">
                              <li>
                                <div class="megamenu-wrap container">
                                  <div class="row">
                                    <div class="col-md-2 megamenu-item"></div>
                                    <div class="col-md-3 megamenu-item">
                                      <ul class="menu-list">
                                        <li><span>For Him</span></li>
                                        <li><a href="m-tops.html">Men's Tops & Bottoms</a></li>
                                        <li><a href="m-foot.html">Men's Footwear</a></li>
                                        <li><a href="m-acc.html">Men's Accessories</a></li>
                                        <li><a href="m-bag.html">Men's Bags & Wallets</a></li>
                                      </ul>
                                    </div>
                                    <div class="col-md-3 megamenu-item">
                                      <ul class="menu-list">
                                        <li><span>For Her</span></li>
                                        <li><a href="w-tops.html">Women's Tops & Bottoms</a></li>
                                        <li><a href="w-foot.html">Women's Footwear</a></li>
                                        <li><a href="w-acc.html">Women's Accessories</a></li>
                                        <li><a href="w-bag.html">Women's Bags & Wallets</a></li>
                                      </ul>
                                    </div>
                                    <div class="col-md-3 megamenu-item">
                                      <ul class="menu-list">
                                        <li><span>For Kids</span></li>
                                        <li><a href="kids.html">Kids Fashion</a></li>
                                        <li><a href="kids-foot.html">Kids Footwear</a></li>
                                      </ul>
                                    </div>
                                  </div>
                                </div>
                              </li>
                            </ul>
                          </li>
                          <li class="dropdown"><a href="about-us.html">About Us</a></li>
                          <li class="dropdown"><a href="contact.html">Contact Us</a></li>
                          <li class="dropdown"><a href="faq.html">F.A.Q</a></li>
                        </ul>
                      </div>
                    </div>
                    <div class="navbar-header flex-child" style="margin-left: -130px;">
                      <div class="logo-wrap">
                        <a href="index.html">
                          <img class="thrifthub" width="160" height="50" src="img/thrifthub lg v1.png" srcset="img/thrifthub lg v1.png 1x, img/thrifthub lg v1.png 2x">
                        </a>
                      </div>
                      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                      </button>
                      <div class="nav-cart mobile-cart hidden-lg hidden-md">
                        <div class="nav-cart-outer">
                          <div class="nav-cart-inner">
                            <a href="#" class="nav-cart-icon"></a>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="flex-child flex-right nav-right hidden-sm hidden-xs">
                      <ul>
                        <li class="nav-register"><a href="myaccount.html"><i class="fa fa-user"></i></a></li>
                       
                        <li class="nav-cart">
                          <div class="nav-cart-outer">
                            <div class="nav-cart-inner">
                              <a href="#" class="nav-cart-icon" id="cartIcon">
                                <span class="nav-cart-badge" id="cartBadge">0</span>
                              </a>
                            </div>
                          </div>
                          <div class="nav-cart-container">
                            <div class="nav-cart-items" id="navCartItems"></div>
                            <div class="nav-cart-summary">
                              <span>Cart Subtotal</span>
                              <span class="total-price" id="navCartSubtotal">RM0.00</span>
                            </div>
                            <div class="nav-cart-actions mt-20">
                              <a href="shop-cart.html" class="btn btn-md btn-dark"><span>View Cart</span></a>
                              <a href="shop-checkout.html" class="btn btn-md btn-color mt-10"><span>Proceed to Checkout</span></a>
                            </div>
                          </div>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </nav>
          </div>
        </div>
      </nav>
    </header>

    <section class="page-title text-center bg-light">
      <div class="container relative clearfix">
        <div class="title-holder">
          <div class="title-text">
            <h1 class="uppercase">Checkout</h1>
            <ol class="breadcrumb">
              <li><a href="index.html">Home</a></li>
              <li><a href="index.html">Shop</a></li>
              <li class="active">Checkout</li>
            </ol>
          </div>
        </div>
      </div>
    </section>

    <div class="content-wrapper oh">
      <section class="section-wrap checkout pb-70">
        <div class="container relative">
          <div class="row">
            <div class="ecommerce col-xs-12">
              

              <form name="checkout" class="checkout ecommerce-checkout row">
                <div class="col-md-8" id="customer_details">
                  <div>
                    <h2 class="heading uppercase bottom-line full-grey mb-30">Billing Address</h2>
                    <p class="form-row form-row-wide address-field update_totals_on_change validate-required" id="billing_country_field">
                      <label for="billing_country">Country <abbr class="required" title="required">*</abbr></label>
                      <select name="billing_country" id="billing_country" class="country_to_state country_select">
                        <option>Select a country…</option>
                        <option value="MY" selected="selected">Malaysia</option>
                      </select>
                    </p>
                    <p class="form-row form-row-first validate-required" id="billing_first_name_field">
                      <label for="billing_first_name">First Name <abbr class="required" title="required">*</abbr></label>
                      <input type="text" class="input-text" name="billing_first_name" id="billing_first_name">
                    </p>
                    <p class="form-row form-row-last validate-required" id="billing_last_name_field">
                      <label for="billing_last_name">Last Name <abbr class="required" title="required">*</abbr></label>
                      <input type="text" class="input-text" name="billing_last_name" id="billing_last_name">
                    </p>
                    <p class="form-row form-row-wide" id="billing_company_field">
                      <label for="billing_company">Company</label>
                      <input type="text" class="input-text" name="billing_company" id="billing_company">
                    </p>
                    <p class="form-row form-row-wide address-field validate-required" id="billing_address_1_field">
                      <label for="billing_address_1">Address <abbr class="required" title="required">*</abbr></label>
                      <input type="text" class="input-text" placeholder="Street address" name="billing_address_1" id="billing_address_1">
                    </p>
                    <p class="form-row form-row-wide address-field" id="billing_address_2_field">
                      <input type="text" class="input-text" placeholder="Apartment, suite, unit etc. (optional)" name="billing_address_2" id="billing_address_2">
                    </p>
                    <p class="form-row form-row-wide address-field validate-required" id="billing_city_field">
                      <label for="billing_city">Town / City <abbr class="required" title="required">*</abbr></label>
                      <input type="text" class="input-text" placeholder="Town / City" name="billing_city" id="billing_city">
                    </p>
                    <p class="form-row form-row-first address-field validate-state" id="billing_state_field">
                      <label for="billing_state">State / County</label>
                      <input type="text" class="input-text" name="billing_state" id="billing_state">
                    </p>
                    <p class="form-row form-row-last address-field validate-required validate-postcode" id="billing_postcode_field">
                      <label for="billing_postcode">Postcode <abbr class="required" title="required">*</abbr></label>
                      <input type="text" class="input-text" placeholder="Postcode" name="billing_postcode" id="billing_postcode">
                    </p>
                    <p class="form-row form-row-first validate-required validate-email" id="billing_email_field">
                      <label for="billing_email">Email Address <abbr class="required" title="required">*</abbr></label>
                      <input type="text" class="input-text" name="billing_email" id="billing_email">
                    </p>
                    <p class="form-row form-row-last validate-required validate-phone" id="billing_phone_field">
                      <label for="billing_phone">Phone <abbr class="required" title="required">*</abbr></label>
                      <input type="text" class="input-text" name="billing_phone" id="billing_phone">
                    </p>
                    <div class="clear"></div>
                  </div>

                  

                  <div class="clear"></div>

                  <div>
                    
                    <p class="form-row notes" id="order_comments_field">
                      <label for="order_comments">Order Notes</label>
                      <textarea name="order_comments" class="input-text" id="order_comments" placeholder="Notes about your order, e.g. special notes for delivery." rows="2" cols="6"></textarea>
                    </p>
                  </div>

                  <div class="clear"></div>
                </div>

                <div class="col-md-4">
                  <div class="order-review-wrap ecommerce-checkout-review-order" id="order_review">
                    <h2 class="heading uppercase bottom-line full-grey">Your Order</h2>
                    <table class="table shop_table ecommerce-checkout-review-order-table" id="cartTable">
                      <thead>
                        <tr>
                          <th class="product-name">Product</th>
                          <th class="product-total" style="text-align: right;">Total</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>

                    <div id="payment" class="ecommerce-checkout-payment">
                      <h2 class="heading uppercase bottom-line full-grey">Payment Method</h2>
                      <div class="payment_methods methods">
                        <button type="button" class="btn btn-lg" id="stripeCheckoutButton">Pay with Stripe</button>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </section>

      <footer class="footer footer-type-1">
        <div class="container">
          <div class="footer-widgets">
            <div class="row">
              <div class="col-md-3 col-sm-12 col-xs-12">
                <div class="widget footer-about-us">
                  <img src="img/thrifthub lg v1.png" alt="" class="logo">
                  <p class="mb-40">ThriftHub store offers wide variety of used clothes at an affordable price.</p>
                  <div class="footer-socials">
                    <div class="social-icons nobase">
                      <a href="https://x.com/thrifthub_mls?s=21"><i class="fa fa-twitter"></i></a>
                      <a href="https://www.facebook.com/share/15CSCqVAFu/?mibextid=wwXIfr"><i class="fa fa-facebook"></i></a>
                      <a href="https://www.instagram.com/thrifthub_malaysia?igsh=YTFoYWFlMDB1Nmc2&utm_source=qr"><i class="fa fa-instagram"></i></a>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-2 col-md-offset-1 col-sm-4 col-xs-12">
                <div class="widget footer-links">
                  <h5 class="widget-title bottom-line left-align grey">Explore</h5>
                  <ul class="list-no-dividers">
                    <li><a href="m-tops.html">Mens</a></li>
                    <li><a href="w-tops.html">Womens</a></li>
                    <li><a href="kids.html">Kids</a></li>
                  </ul>
                </div>
              </div>
              <div class="col-md-2 col-md-offset-1 col-sm-4 col-xs-12">
                <div class="widget footer-links">
                  <h5 class="widget-title bottom-line left-align grey">Information</h5>
                  <ul class="list-no-dividers">
                    <li><a href="delivery-info.html">Delivery Information</a></li>
                    <li><a href="about-us.html">About us</a></li>
                    <li><a href="contact.html">Contact us</a></li>
                    <li><a href="faq.html">F.A.Q</a></li>
                  </ul>
                </div>
              </div>
              <div class="col-md-2 col-md-offset-1 col-sm-4 col-xs-12">
                <div class="widget footer-links">
                  <h5 class="widget-title bottom-line left-align grey">Account</h5>
                  <ul class="list-no-dividers">
                    <li><a href="myaccount.html">My account</a></li>
                    <li><a href="shop-cart.html">My cart</a></li>
                    <li><a href="order-history.html">Order history</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="bottom-footer">
          <div class="container">
            <div class="row">
              <div class="col-sm-6 copyright sm-text-center">
                <span>© <script>document.querySelector(".copyright span").innerHTML += new Date().getFullYear();</script> ThriftHub Malaysia | Made by <a href="">Group 2</a></span>
              </div>
              <div class="col-sm-6 col-xs-12 footer-payment-systems text-right sm-text-center mt-sml-10">
                <i class="fa fa-cc-visa"></i>
                <i class="fa fa-cc-mastercard"></i>
                <i class="fa fa-cc-amex"></i>
              </div>
            </div>
          </div>
        </div>
      </footer>

      <div id="back-to-top">
        <a href="#top"><i class="fa fa-angle-up"></i></a>
      </div>
    </div>
  </main>

  <script type="text/javascript" src="js/jquery.min.js"></script>
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/plugins.js"></script>
  <script type="text/javascript" src="js/scripts.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
  <script src="https://js.stripe.com/v3/"></script>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
    import { getAuth, onAuthStateChanged, signInAnonymously } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
    import { getFirestore, doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyBuks0O6_R_ltzxGJHM-G5LIBvoLvV_P6g",
      authDomain: "thrifthub-demo.firebaseapp.com",
      projectId: "thrifthub-demo",
      storageBucket: "thrifthub-demo.firebasestorage.app",
      messagingSenderId: "518014691134",
      appId: "1:518014691134:web:7fa4a771e1c664c9f92e6f",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const stripe = Stripe('pk_test_51QvgIMImHT6pRs88WKTunLXBUkRtpFZL0LyOqw2KwMAsIywCYPaRzrnb7LRJRlULH7oUFIJOs26Et0tCWRqQkb3o00uS0Wsgh0');

    let cart = [];

    async function loadCart() {
      const storedCart = localStorage.getItem('cart');
      if (storedCart) {
        cart = JSON.parse(storedCart);
        cart.forEach(item => {
          item.quantity = 1;
          if (!item.name) item.name = 'Unnamed Product';
        });
      }
      const user = auth.currentUser;
      if (user) {
        const cartRef = doc(db, "carts", user.uid);
        const cartSnap = await getDoc(cartRef);
        if (cartSnap.exists()) {
          const firebaseCart = cartSnap.data().items || [];
          firebaseCart.forEach(item => {
            item.quantity = 1;
            if (!item.name) item.name = 'Unnamed Product';
          });
          cart = firebaseCart;
        } else {
          await setDoc(cartRef, { items: cart }, { merge: true });
        }
      }
      displayCart();
      updateNavCart();
    }

    function displayCart() {
      const cartTableBody = document.getElementById('cartTable').querySelector('tbody');
      cartTableBody.innerHTML = '';
      let total = 0;

      if (cart.length === 0) {
        cartTableBody.innerHTML = '<tr><td colspan="2">Your cart is empty.</td></tr>';
      } else {
        cart.forEach(item => {
          if (!item.name || !item.price) {
            console.error('Invalid cart item:', item);
            return;
          }
          const row = `
            <tr>
              <td class="product-name" style="text-align:left;">${item.name} <span class="count">x 1</span></td>
              <td class="product-total"><span class="amount">RM${item.price.toFixed(2)}</span></td>
            </tr>
          `;
          cartTableBody.insertAdjacentHTML('beforeend', row);
          total += item.price;
        });
      }

      const subtotalRow = `
        <tr class="cart-subtotal">
          <th>Cart Subtotal</th>
          <td><span class="amount">RM${total.toFixed(2)}</span></td>
        </tr>
      `;
      const shippingRow = `
        <tr class="shipping">
          <th>Shipping</th>
          <td><span>Free Shipping</span></td>
        </tr>
      `;
      const totalRow = `
        <tr class="order-total">
          <th><strong>Order Total</strong></th>
          <td><strong><span class="amount">RM${total.toFixed(2)}</span></strong></td>
        </tr>
      `;
      cartTableBody.insertAdjacentHTML('beforeend', subtotalRow + shippingRow + totalRow);
    }

    async function handleStripeCheckout() {
      const user = auth.currentUser;
      if (!user) {
        alert('Please sign in to proceed with checkout.');
        return;
      }

      try {
        const lineItems = cart.map(item => ({
          price_data: {
            currency: 'myr',
            product_data: {
              name: item.name || 'Unnamed Product',
            },
            unit_amount: Math.round(item.price * 100),
          },
          quantity: 1,
        }));

        const response = await fetch('https://us-central1-thrifthub-demo.cloudfunctions.net/createCheckoutSession', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ lineItems, userId: user.uid }),
        });

        if (!response.ok) {
          throw new Error('Failed to create checkout session: ' + await response.text());
        }

        const session = await response.json();
        stripe.redirectToCheckout({ sessionId: session.id });
      } catch (error) {
        console.error('Error processing payment:', error);
        alert('Error processing payment. Please try again.');
      }
    }

    async function saveCart() {
      localStorage.setItem('cart', JSON.stringify(cart));
      const user = auth.currentUser;
      if (user) {
        const cartRef = doc(db, "carts", user.uid);
        await setDoc(cartRef, { items: cart }, { merge: true });
      }
    }

    onAuthStateChanged(auth, (user) => {
      if (user) {
        loadCart();
      } else {
        signInAnonymously(auth).catch((error) => {
          console.error('Error signing in anonymously:', error);
          alert('Please sign in to proceed with checkout.');
          window.location.href = 'myaccount.html';
        });
      }
    });

    document.getElementById('stripeCheckoutButton').addEventListener('click', handleStripeCheckout);

    function updateNavCart() {
      const cartBadge = document.getElementById('cartBadge');
      const navCartItems = document.getElementById('navCartItems');
      const navCartSubtotal = document.getElementById('navCartSubtotal');
      const cartIcon = document.getElementById('cartIcon');

      cartBadge.textContent = cart.length || 0;

      if (cart.length === 0) {
        navCartItems.innerHTML = '<p class="nav-cart-item">Your cart is empty.</p>';
        navCartSubtotal.textContent = 'RM0.00';
      } else {
        navCartItems.innerHTML = '';
        cart.forEach((item) => {
          item.quantity = 1;
          if (!item.name) item.name = 'Unnamed Product';
          const itemHtml = `
            <div class="nav-cart-item clearfix">
              <div class="nav-cart-img">
                <a href="shop-single.html?id=${item.id}">
                  <img src="${item.imageUrl || 'img/shop/shop_item_1.jpg'}" alt="${item.name}">
                </a>
              </div>
              <div class="nav-cart-title">
                <a href="shop-single.html?id=${item.id}">${item.name}</a>
                <div class="nav-cart-price">
                  <span>1 x</span>
                  <span>RM${item.price.toFixed(2)}</span>
                </div>
              </div>
              <div class="nav-cart-remove">
                <a href="#" class="remove" data-id="${item.id}" title="Remove this item">
                  <i class="ui-close"></i>
                </a>
              </div>
            </div>
          `;
          navCartItems.insertAdjacentHTML('beforeend', itemHtml);
        });

        const subtotal = cart.reduce((sum, item) => sum + item.price, 0);
        navCartSubtotal.textContent = `RM${subtotal.toFixed(2)}`;

        document.querySelectorAll('.nav-cart-remove .remove').forEach(remove => {
          remove.addEventListener('click', (e) => {
            e.preventDefault();
            const productId = e.target.getAttribute('data-id');
            cart = cart.filter(item => item.id !== productId);
            saveCart();
            updateNavCart();
            displayCart();
          });
        });
      }

      cartIcon.addEventListener('click', (e) => {
        e.preventDefault();
        const cartContainer = cartIcon.closest('.nav-cart').querySelector('.nav-cart-container');
        cartContainer.style.display = cartContainer.style.display === 'block' ? 'none' : 'block';
      });

      document.addEventListener('click', (e) => {
        const cartContainer = document.querySelector('.nav-cart-container');
        if (!cartIcon.contains(e.target) && !cartContainer.contains(e.target)) {
          cartContainer.style.display = 'none';
        }
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadCart();
    });

    window.addEventListener('storage', () => {
      cart = JSON.parse(localStorage.getItem('cart')) || [];
      cart.forEach(item => {
        item.quantity = 1;
        if (!item.name) item.name = 'Unnamed Product';
      });
      displayCart();
      updateNavCart();
    });
  </script>
  <script>
    // Programmatic Google Cloud Translate API
async function translateText(text, targetLang) {
    const apiKey = "AIzaSyARV7pg1hw8TQhNYV1f-FbrAE6Hih2FxmQ"; // Replace with your Google Cloud API key
    const url = `https://translation.googleapis.com/language/translate/v2?key=${apiKey}&q=${encodeURIComponent(text)}&target=${targetLang}&source=en`;
    try {
      const response = await fetch(url);
      const data = await response.json();
      return data.data.translations[0].translatedText;
    } catch (error) {
      console.error("Translation error:", error);
      return text;
    }
  }

  async function updateTranslations(lang) {
    // Select all text-containing elements, excluding scripts, styles, and specific non-text elements
    const elements = document.querySelectorAll("body *:not(script):not(style):not(img):not(video):not(source):not(link):not(meta)");
    for (const element of elements) {
      // Reset translated state for all elements before translating
      element.removeAttribute('data-translated');

      if (element.childNodes.length === 1 && element.childNodes[0].nodeType === Node.TEXT_NODE) {
        const text = element.textContent.trim();
        if (text) {
          let translated = await translateText(text, lang);
          // Special handling for Jawi (ms-Arab): Convert standard Malay to Jawi script if possible
          if (lang === 'ms-Arab') {
            translated = convertToJawi(translated); // Custom function for Jawi conversion
          }
          element.textContent = translated;
          element.setAttribute('data-translated', 'true'); // Mark as translated
          if (lang === 'ms-Arab') {
            element.classList.add('jawi-text'); // Apply Jawi font class
          } else {
            element.classList.remove('jawi-text'); // Remove Jawi font class for other languages
          }
        }
      } else {
        // Handle elements with mixed content (e.g., text and children)
        for (const child of element.childNodes) {
          if (child.nodeType === Node.TEXT_NODE && child.textContent.trim()) {
            const text = child.textContent.trim();
            if (!child.parentElement.hasAttribute('data-translated')) {
              let translated = await translateText(text, lang);
              if (lang === 'ms-Arab') {
                translated = convertToJawi(translated); // Custom function for Jawi conversion
              }
              child.textContent = translated;
              child.parentElement.setAttribute('data-translated', 'true'); // Mark parent as translated
              if (lang === 'ms-Arab') {
                child.parentElement.classList.add('jawi-text'); // Apply Jawi font class
              } else {
                child.parentElement.classList.remove('jawi-text'); // Remove Jawi font class for other languages
              }
            }
          }
        }
      }
    }
    document.getElementById("currentLanguage").textContent = lang === "en" ? "ENG" : 
                                                          lang === "ms" ? "MS" : 
                                                          lang === "zh" ? "ZH" : 
                                                          lang === "zh-TW" ? "ZH-TW" : 
                                                          lang === "ko" ? "KO" : 
                                                          lang === "ja" ? "JA" : 
                                                          lang === "ms-Arab" ? "MS-JAWI" : 
                                                          "TA";
  }

  // Custom function to convert standard Malay to Jawi script (simplified example)
  function convertToJawi(text) {
    // This is a basic example; you may need a more comprehensive mapping or a third-party library
    const jawiMapping = {
      'a': 'ا', 'b': 'ب', 'c': 'ج', 'd': 'د', 'e': 'ە', 'f': 'ف', 'g': 'گ', 'h': 'ه', 'i': 'ي', 'j': 'ج',
      'k': 'ك', 'l': 'ل', 'm': 'م', 'n': 'ن', 'o': 'و', 'p': 'پ', 'q': 'ق', 'r': 'ر', 's': 'س', 't': 'ت',
      'u': 'و', 'v': 'ڤ', 'w': 'و', 'x': 'کس', 'y': 'ي', 'z': 'ز'
      // Add more mappings for vowels, diacritics, and special characters as needed
    };
    let jawiText = '';
    for (let char of text.toLowerCase()) {
      jawiText += jawiMapping[char] || char; // Use mapping if available, otherwise keep original char
    }
    return jawiText;
  }

  document.querySelectorAll(".language-option").forEach(option => {
    option.addEventListener("click", async (e) => {
      e.preventDefault();
      const lang = option.getAttribute("data-lang");
      await updateTranslations(lang);
    });
  });
</script>
</body>
</html>
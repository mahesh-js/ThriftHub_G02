<!DOCTYPE html>
<html lang="en">
<head>
  <title>ThriftHub Malaysia | Shop </title>

  <meta charset="utf-8">
  <!--[if IE]><meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'><![endif]-->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="">
  
  <!-- Google Fonts -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700%7COpen+Sans:400,400i,600,700' rel='stylesheet'>
<!-- Jawi Font (Optional: Add a Jawi-specific font for rendering) -->
<link href="https://fonts.googleapis.com/css2?family=Scheherazade&display=swap" rel="stylesheet">
  <!-- Css -->
  <link rel="stylesheet" href="css/bootstrap.min.css" />
  <link rel="stylesheet" href="css/magnific-popup.css" />
  <link rel="stylesheet" href="css/font-icons.css" />
  <link rel="stylesheet" href="css/sliders.css" />
  <link rel="stylesheet" href="css/style.css" />

  <!-- Favicons -->
  <link rel="shortcut icon" href="img/favicon.ico">
  <link rel="apple-touch-icon" href="img/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="72x72" href="img/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="114x114" href="img/apple-touch-icon-114x114.png">
</head>
<style>
  .jawi-text {
      font-family: 'Scheherazade', Arial, sans-serif;
      direction: rtl; /* Right-to-left for Jawi script */
    }
</style>
<body class="relative">
  <!-- Preloader -->
  <div class="loader-mask">
    <div class="loader">
      <div></div>
      <div></div>
    </div>
  </div>

  <main class="main-wrapper">
    <header class="nav-type-1">
      <!-- Fullscreen search -->
      <div class="search-wrap">
        <div class="search-inner">
          <div class="search-cell">
            <form method="get">
              <div class="search-field-holder">
                <input type="search" class="form-control main-search-input" placeholder="Search for">
                <i class="ui-close search-close" id="search-close"></i>
              </div>            
            </form>
          </div>
        </div>        
      </div> <!-- end fullscreen search -->

      <!-- Top Bar -->
      <div class="top-bar hidden-xs">
        <div class="container">
          <div class="top-bar-links flex-parent">
            <ul class="top-bar-currency-language">
              <li>
                Currency: <a href="#">MYR<i class="fa fa-angle-down"></i></a>
                <div class="currency-dropdown">
                  <ul>
                    <li><a href="#">MYR</a></li>
                    <li><a href="#">SGD</a></li>
                  </ul>
                </div>
              </li>
              <li class="language">
                Language: <a href="#" id="currentLanguage">ENG<i class="fa fa-angle-down"></i></a>
                <div class="language-dropdown">
                  <ul>
                    <li><a href="#" class="language-option" data-lang="en">English</a></li>
                    <li><a href="#" class="language-option" data-lang="ms">Malay</a></li>
                    <li><a href="#" class="language-option" data-lang="zh">Chinese (Simplified)</a></li>
                    <li><a href="#" class="language-option" data-lang="zh-TW">Chinese (Traditional)</a></li>
                    <li><a href="#" class="language-option" data-lang="ko">Korean</a></li>
                    <li><a href="#" class="language-option" data-lang="ja">Japanese</a></li>
                    <li><a href="#" class="language-option" data-lang="ms-Arab">Malay (Jawi)</a></li>
                    <li><a href="#" class="language-option" data-lang="ta">Tamil</a></li>
                  </ul>
                </div>
              </li>
            </ul>
            <ul class="top-bar-acc" style="margin-right: 38%;">
              Pre-Raya Sale: Enjoy Free Shipping! <a href="m-tops.html" style="color:darkgoldenrod;">Shop Now</a>
            </ul>
           
          </div>
        </div>
      </div> <!-- end top bar -->

      <nav class="navbar navbar-responsive-top">
        <div class="navigation" id="sticky-nav">
          <div class="container relative">
            <nav class="navbar navbar-static-top">
              <div class="navigation" id="sticky-nav">
                <div class="container relative">
                  <div class="row flex-parent">
                    <div class="nav-wrap flex-child" style="margin-left: -60px;">
                      <div class="collapse navbar-collapse text-left" id="navbar-collapse">
                        <ul class="nav navbar-nav">
                          <li class="dropdown">
                            <a href="#">Shop</a>
                            <i class="fa fa-angle-down dropdown-trigger"></i>
                            <ul class="dropdown-menu megamenu-wide">
                              <li>
                                <div class="megamenu-wrap container">
                                  <div class="row">
                                    <div class="col-md-2 megamenu-item"></div>
                                    <div class="col-md-3 megamenu-item">
                                      <ul class="menu-list">
                                        <li><span>For Him</span></li>
                                        <li><a href="m-tops.html">Men's Tops & Bottoms</a></li>
                                        <li><a href="m-foot.html">Men's Footwear</a></li>
                                        <li><a href="m-acc.html">Men's Accessories</a></li>
                                        <li><a href="m-bag.html">Men's Bags & Wallets</a></li>
                                      </ul>
                                    </div>
                                    <div class="col-md-3 megamenu-item">
                                      <ul class="menu-list">
                                        <li><span>For Her</span></li>
                                        <li><a href="w-tops.html">Women's Tops & Bottoms</a></li>
                                        <li><a href="w-foot.html">Women's Footwear</a></li>
                                        <li><a href="w-acc.html">Women's Accessories</a></li>
                                        <li><a href="w-bag.html">Women's Bags & Wallets</a></li>
                                      </ul>
                                    </div>
                                    <div class="col-md-3 megamenu-item">
                                      <ul class="menu-list">
                                        <li><span>For Kids</span></li>
                                        <li><a href="kids.html">Kids Fashion</a></li>
                                        <li><a href="kids-foot.html">Kids Footwear</a></li>
                                      </ul>
                                    </div>
                                  </div>
                                </div>
                              </li>
                            </ul>
                          </li>
                          <li class="dropdown"><a href="about-us.html">About Us</a></li>
                          <li class="dropdown"><a href="contact.html">Contact Us</a></li>
                          <li class="dropdown"><a href="faq.html">F.A.Q</a></li>
                        </ul> <!-- end menu -->
                      </div> <!-- end collapse -->
                    </div> <!-- end col -->
                    <div class="navbar-header flex-child" style="margin-left: -130px;">
                      <div class="logo-wrap">
                        <a href="index.html">
                          <img class="thrifthub" width="160" height="50" src="img/thrifthub lg v1.png" srcset="img/thrifthub lg v1.png 1x, img/thrifthub lg v1.png 2x">
                        </a>
                      </div>
                      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                      </button>
                      <div class="nav-cart mobile-cart hidden-lg hidden-md">
                        <div class="nav-cart-outer">
                          <div class="nav-cart-inner">
                            <a href="#" class="nav-cart-icon">
                              <span class="nav-cart-badge">2</span>
                            </a>
                          </div>
                        </div>
                      </div>
                    </div> <!-- end navbar-header -->
                    <div class="flex-child flex-right nav-right hidden-sm hidden-xs">
                      <ul>
                        <li class="nav-register"><a href="signin.html"><i class="fa fa-user"></i></a></li>
                        <li class="nav-search-wrap style-2 hidden-sm hidden-xs">
                          <a href="#" class="nav-search search-trigger">
                            <i class="fa fa-search"></i>
                          </a>
                        </li>
                      </ul>
                    </div>
                  </div> <!-- end row -->
                </div> <!-- end container -->
              </div> <!-- end navigation -->
            </nav> <!-- end navbar -->
          </div>
        </div>
      </nav>
    </header>
    <hr>

    <div class="content-wrapper oh">
      <!-- Single Product -->
      <section class="section-wrap pb-40 single-product">
        <div class="container-fluid semi-fluid">
          <div class="row">
            <div class="col-md-6 col-xs-12 product-slider mb-60">
              <div class="flickity flickity-slider-wrap mfp-hover" id="gallery-main" data-flickity='{ "cellAlign": "left", "contain": true, "pageDots": false, "prevNextButtons": true }'>
                <!-- Product images will be dynamically inserted here -->
              </div> <!-- end gallery main -->
              <div class="gallery-thumbs">
                <!-- Thumbnails will be dynamically inserted here -->
              </div> <!-- end gallery thumbs -->
            </div> <!-- end col img slider -->
            <div class="col-md-6 col-xs-12 product-description-wrap">
              <ol class="breadcrumb">
                <li><a href="index.html">Home</a></li>
                <li><a href="index.html">Shop</a></li>
                <li class="active" id="productCategory"></li>
              </ol>
              <h1 class="product-title" id="productTitle">Product Title</h1>              
              <span class="price" id="productPrice">
                <del><span>RM155.00</span></del>
                <ins><span class="amount">RM125.00</span></ins>
              </span>
              <span class="rating"><a href="#">3 Reviews</a></span>
              <p class="short-description" id="productDescription">Product description will appear here.</p>
              <div class="color-swatches clearfix">
                <span>Color:</span>
                <a href="#" class="size-m">same as picture</a>
              </div>
              <div class="size-options clearfix">
                <span>Size:</span>
                <a href="#" class="size-m" id="productSize">M</a>
              </div>
              <div class="product-actions">
                <span>Qty:</span>
                <div class="quantity buttons_added">                  
                  <input type="number" step="1" min="0" value="1" title="Qty" class="input-text qty text" />
                  <div class="quantity-adjust">
                    <a href="#" class="plus"><i class="fa fa-angle-up"></i></a>
                    <a href="#" class="minus"><i class="fa fa-angle-down"></i></a>
                  </div>
                </div>
                <a href="signin.html" class="btn btn-dark btn-lg add-to-cart"><span>Add to Cart</span></a>
                                         
              </div>
              <div class="product_meta">
                <span class="sku">SKU: <a href="#" id="productSKU"></a></span>
                <span class="brand_as">Category: <a href="#" id="productCategoryLink">Men's Tops & Bottoms</a></span>
                <span class="posted_in">Tags: <a href="#" id="productTags"></a></span>                
              </div>
              <!-- Accordion -->
              <div class="panel-group accordion mb-50" id="accordion">
                <div class="panel">
                  <div class="panel-heading">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" class="minus">Description<span> </span></a>
                  </div>
                  <div id="collapseOne" class="panel-collapse collapse in">
                    <div class="panel-body" id="productFullDescription">
                      Our products are carefully curated to meet high-quality standards, ensuring you find something special with every purchase.
                    </div>
                  </div>
                </div>
                <div class="panel">
                  <div class="panel-heading">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" class="plus">Information<span> </span></a>
                  </div>
                  <div id="collapseTwo" class="panel-collapse collapse">
                    <div class="panel-body">
                      <table class="table shop_attributes">
                        <tbody>
                          <tr><th>Size:</th><td id="productSize1"></td></tr>
                          <tr><th>Condition:</th><td id="productCondition">Like New</td></tr>
                          <tr><th>Shipping To:</th><td id="productShipping">West & East Malaysia</td></tr>                                     
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
                <div class="panel">
                  <div class="panel-heading">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" class="plus">Reviews<span> </span></a>
                  </div>
                  <div id="collapseThree" class="panel-collapse collapse">
                    <div class="panel-body">
                      <div class="reviews">
                        <ul class="reviews-list">
                          <li>
                            <div class="review-body">
                              <div class="review-content">
                                <p class="review-author"><strong>Amirul Hafiz</strong> - Feb 6, 2025</p>
                                <div class="rating"><a href="#"></a></div>
                                <p>The quality of items on ThriftHub exceeded my expectations. I found great deals on branded clothes and accessories, all in excellent condition.</p>
                              </div>
                            </div>
                          </li>
                          <li>
                            <div class="review-body">
                              <div class="review-content">
                                <p class="review-author"><strong>Aisyah</strong> - Jan 20, 2025</p>
                                <div class="rating"><a href="#"></a></div>
                                <p>ThriftHub Malaysia is my go-to platform for finding vintage clothes. The user-friendly interface and fast delivery make it an even better experience.</p>
                              </div>
                            </div>
                          </li>
                        </ul>         
                      </div> <!-- end reviews -->
                    </div>
                  </div>
                </div>
              </div>
              <div class="socials-share clearfix">
                <span>Share:</span>
                <div class="social-icons nobase">
                  <a href="https://x.com/thrifthub_mls?s=21"><i class="fa fa-twitter"></i></a>
                  <a href="https://www.facebook.com/share/15CSCqVAFu/?mibextid=wwXIfr"><i class="fa fa-facebook"></i></a>
                  <a href="https://www.instagram.com/thrifthub_malaysia?igsh=YTFoYWFlMDB1Nmc2&utm_source=qr"><i class="fa fa-instagram"></i></a>
                </div>
              </div>
            </div> <!-- end col product description -->
          </div> <!-- end row -->
        </div> <!-- end container -->
      </section> <!-- end single product -->

      <!-- Footer Type-1 -->
      <footer class="footer footer-type-1">
        <div class="container">
          <div class="footer-widgets">
            <div class="row">
              <div class="col-md-5 col-sm-12 col-xs-12">
                <div class="widget footer-about-us">
                  <img src="img/thrifthub lg v1.png" alt="" class="logo">
                  <p class="mb-40">ThriftHub store offers wide variety of used clothes at an affordable price.</p>
                  <div class="footer-socials">
                    <div class="social-icons nobase">
                      <a href="https://x.com/thrifthub_mls?s=21"><i class="fa fa-twitter"></i></a>
                      <a href="https://www.facebook.com/share/15CSCqVAFu/?mibextid=wwXIfr"><i class="fa fa-facebook"></i></a>
                      <a href="https://www.instagram.com/thrifthub_malaysia?igsh=YTFoYWFlMDB1Nmc2&utm_source=qr"><i class="fa fa-instagram"></i></a>
                    </div>
                  </div>
                </div>
              </div> <!-- end about us -->
              <div class="col-md-2 col-md-offset-1 col-sm-4 col-xs-12">
                <div class="widget footer-links">
                  <h5 class="widget-title bottom-line left-align grey">Explore</h5>
                  <ul class="list-no-dividers">
                    <li><a href="m-tops.html">Mens</a></li>
                    <li><a href="w-tops.html">Womens</a></li>
                    <li><a href="kids.html">Kids</a></li>
                  </ul>
                </div>
              </div>
              <div class="col-md-3 col-md-offset-1 col-sm-4 col-xs-12">
                <div class="widget footer-links">
                  <h5 class="widget-title bottom-line left-align grey">Information</h5>
                  <ul class="list-no-dividers">
                    <li><a href="delivery-info.html">Delivery Information</a></li>
                    <li><a href="about-us.html">About us</a></li>
                    <li><a href="contact.html">Contact us</a></li>
                    <li><a href="faq.html">F.A.Q</a></li>
                  </ul>
                </div>
              </div>
            </div> <!-- end row -->
          </div> <!-- end footer widgets -->
        </div> <!-- end container -->

        <div class="bottom-footer">
          <div class="container">
            <div class="row">
              <div class="col-sm-6 copyright sm-text-center">
                <span>
                  © <script>document.querySelector(".copyright span").innerHTML += new Date().getFullYear();</script>
                  ThriftHub Malaysia | Made by <a href="">Group 2</a>
                </span>
              </div>
              <div class="col-sm-6 col-xs-12 footer-payment-systems text-right sm-text-center mt-sml-10">
                <i class="fa fa-cc-visa"></i>
                <i class="fa fa-cc-mastercard"></i>
                <i class="fa fa-cc-amex"></i>
              </div>
            </div>
          </div>
        </div> <!-- end bottom footer -->
      </footer> <!-- end footer -->

      <div id="back-to-top">
        <a href="#top"><i class="fa fa-angle-up"></i></a>
      </div>
    </div> <!-- end content wrapper -->
  </main> <!-- end main wrapper -->

  <!-- jQuery Scripts -->
  <script type="text/javascript" src="js/jquery.min.js"></script>
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/plugins.js"></script>  
  <script type="text/javascript" src="js/scripts.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
    import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
    import { getFirestore, doc, getDoc, collection, query, where, limit, getDocs } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBuks0O6_R_ltzxGJHM-G5LIBvoLvV_P6g",
      authDomain: "thrifthub-demo.firebaseapp.com",
      projectId: "thrifthub-demo",
      storageBucket: "thrifthub-demo.firebasestorage.app",
      messagingSenderId: "518014691134",
      appId: "1:518014691134:web:7fa4a771e1c664c9f92e6f",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Sign in anonymously for testing
    signInAnonymously(auth).catch((error) => {
      console.error("Error signing in anonymously:", error);
    });

    // Category Mapping
    const categoryMap = {
      "m-tops.html": { name: "Men's Tops & Bottoms", url: "m-tops.html" },
      "m-foot.html": { name: "Men's Footwear", url: "m-foot.html" },
      "m-acc.html": { name: "Men's Accessories", url: "m-acc.html" },
      "m-bag.html": { name: "Men's Bags & Wallets", url: "m-bag.html" },
      "w-tops.html": { name: "Women's Tops & Bottoms", url: "w-tops.html" },
      "w-foot.html": { name: "Women's Footwear", url: "w-foot.html" },
      "w-acc.html": { name: "Women's Accessories", url: "w-acc.html" },
      "w-bag.html": { name: "Women's Bags & Wallets", url: "w-bag.html" },
      "kids.html": { name: "Kids Fashion", url: "kids.html" },
      "kids-foot.html": { name: "Kids Footwear", url: "kids-foot.html" },
    };

    // Function to load and display a single product
    async function loadProduct() {
      const urlParams = new URLSearchParams(window.location.search);
      const productId = urlParams.get('id');

      if (!productId) {
        document.querySelector('.product-slider').innerHTML = '<p class="error-message">No product ID provided.</p>';
        document.querySelector('.product-description-wrap').innerHTML = '<p class="error-message">No product ID provided.</p>';
        return;
      }

      try {
        const productDoc = await getDoc(doc(db, "products", productId));
        if (productDoc.exists()) {
          const product = productDoc.data();

          // Update product title
          document.getElementById('productTitle').textContent = product.title || 'Untitled';

          // Update product price
          const priceElement = document.getElementById('productPrice');
          if (product.price) {
            priceElement.innerHTML = product.price < (product.price * 1.3) ? `
              <del><span>RM${(product.price * 1.3).toFixed(2)}</span></del>
              <ins><span class="amount">RM${product.price.toFixed(2)}</span></ins>` :
              `<ins><span class="amount">RM${product.price.toFixed(2)}</span></ins>`;
          } else {
            priceElement.innerHTML = '<ins><span class="amount">RM0.00</span></ins>';
          }

          // Update product description
          document.getElementById('productDescription').textContent = product.description || 'No description available.';
          document.getElementById('productFullDescription').textContent = product.description || 'Our products are carefully curated to meet high-quality standards, ensuring you find something special with every purchase.';

          // Update product category dynamically using the category map
          const categoryKey = product.category || 'Uncategorized';
          const categoryInfo = categoryMap[categoryKey] || { name: 'Uncategorized', url: '#' };
          document.getElementById('productCategory').textContent = categoryInfo.name;
          document.getElementById('productCategoryLink').textContent = categoryInfo.name;
          document.getElementById('productCategoryLink').href = categoryInfo.url;

          // Update product SKU and tags
          document.getElementById('productSKU').textContent = product.id || 'SKU-001';
          document.getElementById('productTags').textContent = `${categoryInfo.name}, ${product.title || 'Product'}, Fashion`;

          // Update product size, condition, and shipping
          document.getElementById('productSize').textContent = product.size || 'N/A';
          document.getElementById('productSize1').textContent = product.size || 'N/A';
          document.getElementById('productCondition').textContent = 'Like New';
          document.getElementById('productShipping').textContent = 'West & East Malaysia';

          // Update product images in the slider
          const galleryMain = document.getElementById('gallery-main');
          const galleryThumbs = document.querySelector('.gallery-thumbs');
          galleryMain.innerHTML = '';
          galleryThumbs.innerHTML = '';

          const imageUrls = [product.imageUrl || 'img/shop/item_lg_1.jpg'];
          imageUrls.forEach((url, index) => {
            const mainCell = `
              <div class="gallery-cell">
                <a href="${url}" class="lightbox-img">
                  <img src="${url}" alt="${product.title || 'Product'}" />
                  <i class="ui-zoom zoom-icon"></i>
                </a>
              </div>`;
            galleryMain.insertAdjacentHTML('beforeend', mainCell);

            const thumbCell = `
              <div class="gallery-cell">
                <img src="${url}" alt="${product.title || 'Product'}" />
              </div>`;
            galleryThumbs.insertAdjacentHTML('beforeend', thumbCell);
          });

          // Load related products
          loadRelatedProducts(product.category, productId);
        } else {
          document.querySelector('.product-slider').innerHTML = '<p class="error-message">Product not found.</p>';
          document.querySelector('.product-description-wrap').innerHTML = '<p class="error-message">Product not found.</p>';
        }
      } catch (error) {
        console.error("Error loading product:", error);
        document.querySelector('.product-slider').innerHTML = '<p class="error-message">Error loading product. Please try again later.</p>';
        document.querySelector('.product-description-wrap').innerHTML = '<p class="error-message">Error loading product. Please try again later.</p>';
      }
    }

    // Function to load related products
    async function loadRelatedProducts(category, currentProductId) {
      const relatedProductsSection = document.createElement('section');
      relatedProductsSection.className = 'section-wrap pt-0 shop-items-slider';
      relatedProductsSection.innerHTML = `
        <div class="container-fluid semi-fluid">
          <div class="row heading-row">
            <div class="col-md-12 text-center">
              <h2 class="heading bottom-line">Related Products</h2>
            </div>
          </div>
          <div class="row">
            <div id="owl-related-items" class="owl-carousel owl-theme"></div>
          </div>
        </div>
      `;

      // Insert after single-product section
      const singleProductSection = document.querySelector('.single-product');
      singleProductSection.insertAdjacentElement('afterend', relatedProductsSection);

      try {
        const q = query(
          collection(db, "products"),
          where("category", "==", category),
          limit(6)
        );
        const querySnapshot = await getDocs(q);
        const relatedItemsContainer = document.getElementById('owl-related-items');
        relatedItemsContainer.innerHTML = '';

        querySnapshot.forEach((doc) => {
          const product = doc.data();
          const productId = doc.id;

          // Skip the current product
          if (productId === currentProductId) return;

          const categoryInfo = categoryMap[product.category] || { name: 'Uncategorized', url: '#' };
          const productHtml = `
            <div class="product">
              <div class="product-item hover-trigger">
                <div class="product-img">
                  <a href="shop-single.html?id=${productId}">
                    <img src="${product.imageUrl || 'img/shop/item_lg_1.jpg'}" alt="${product.title || 'Product'}">
                    <img src="${product.imageUrl || 'img/shop/item_lg_1.jpg'}" alt="${product.title || 'Product'}" class="back-img">
                  </a>
                  ${product.price < (product.price * 1.3) ? '<div class="product-label"><span class="sale">sale</span></div>' : ''}
                 
                  <a href="shop-single.html?id=${productId}" class="product-quickview">Quick View</a>
                </div>
                <div class="product-details">
                  <h3 class="product-title">
                    <a href="shop-single.html?id=${productId}">${product.title || 'Untitled'}</a>
                  </h3>
                  <span class="category">
                    <a href="${categoryInfo.url}">${categoryInfo.name}</a>
                  </span>
                </div>
                <span class="price">
                  ${product.price && product.price < (product.price * 1.3) ? `
                    <del><span>RM${(product.price * 1.3).toFixed(2)}</span></del>
                    <ins><span class="amount">RM${product.price.toFixed(2)}</span></ins>` : 
                    `<ins><span class="amount">RM${product.price.toFixed(2)}</span></ins>`}
                </span>
              </div>
            </div>
          `;
          relatedItemsContainer.insertAdjacentHTML('beforeend', productHtml);
        });

        // Initialize Owl Carousel if available
        if (typeof jQuery !== 'undefined' && jQuery.fn.owlCarousel) {
          jQuery('#owl-related-items').owlCarousel({
            loop: true,
            margin: 10,
            nav: true,
            responsive: {
              0: { items: 1 },
              600: { items: 3 },
              1000: { items: 5 }
            }
          });
        }
      } catch (error) {
        console.error("Error loading related products:", error);
        relatedItemsContainer.innerHTML = '<p>Error loading related products.</p>';
      }
    }

    // Load product when the page loads
    document.addEventListener("DOMContentLoaded", () => {
      loadProduct();
    });
  </script>
  <script>
    // Programmatic Google Cloud Translate API
async function translateText(text, targetLang) {
    const apiKey = "AIzaSyARV7pg1hw8TQhNYV1f-FbrAE6Hih2FxmQ"; // Replace with your Google Cloud API key
    const url = `https://translation.googleapis.com/language/translate/v2?key=${apiKey}&q=${encodeURIComponent(text)}&target=${targetLang}&source=en`;
    try {
      const response = await fetch(url);
      const data = await response.json();
      return data.data.translations[0].translatedText;
    } catch (error) {
      console.error("Translation error:", error);
      return text;
    }
  }

  async function updateTranslations(lang) {
    // Select all text-containing elements, excluding scripts, styles, and specific non-text elements
    const elements = document.querySelectorAll("body *:not(script):not(style):not(img):not(video):not(source):not(link):not(meta)");
    for (const element of elements) {
      // Reset translated state for all elements before translating
      element.removeAttribute('data-translated');

      if (element.childNodes.length === 1 && element.childNodes[0].nodeType === Node.TEXT_NODE) {
        const text = element.textContent.trim();
        if (text) {
          let translated = await translateText(text, lang);
          // Special handling for Jawi (ms-Arab): Convert standard Malay to Jawi script if possible
          if (lang === 'ms-Arab') {
            translated = convertToJawi(translated); // Custom function for Jawi conversion
          }
          element.textContent = translated;
          element.setAttribute('data-translated', 'true'); // Mark as translated
          if (lang === 'ms-Arab') {
            element.classList.add('jawi-text'); // Apply Jawi font class
          } else {
            element.classList.remove('jawi-text'); // Remove Jawi font class for other languages
          }
        }
      } else {
        // Handle elements with mixed content (e.g., text and children)
        for (const child of element.childNodes) {
          if (child.nodeType === Node.TEXT_NODE && child.textContent.trim()) {
            const text = child.textContent.trim();
            if (!child.parentElement.hasAttribute('data-translated')) {
              let translated = await translateText(text, lang);
              if (lang === 'ms-Arab') {
                translated = convertToJawi(translated); // Custom function for Jawi conversion
              }
              child.textContent = translated;
              child.parentElement.setAttribute('data-translated', 'true'); // Mark parent as translated
              if (lang === 'ms-Arab') {
                child.parentElement.classList.add('jawi-text'); // Apply Jawi font class
              } else {
                child.parentElement.classList.remove('jawi-text'); // Remove Jawi font class for other languages
              }
            }
          }
        }
      }
    }
    document.getElementById("currentLanguage").textContent = lang === "en" ? "ENG" : 
                                                          lang === "ms" ? "MS" : 
                                                          lang === "zh" ? "ZH" : 
                                                          lang === "zh-TW" ? "ZH-TW" : 
                                                          lang === "ko" ? "KO" : 
                                                          lang === "ja" ? "JA" : 
                                                          lang === "ms-Arab" ? "MS-JAWI" : 
                                                          "TA";
  }

  // Custom function to convert standard Malay to Jawi script (simplified example)
  function convertToJawi(text) {
    // This is a basic example; you may need a more comprehensive mapping or a third-party library
    const jawiMapping = {
      'a': 'ا', 'b': 'ب', 'c': 'ج', 'd': 'د', 'e': 'ە', 'f': 'ف', 'g': 'گ', 'h': 'ه', 'i': 'ي', 'j': 'ج',
      'k': 'ك', 'l': 'ل', 'm': 'م', 'n': 'ن', 'o': 'و', 'p': 'پ', 'q': 'ق', 'r': 'ر', 's': 'س', 't': 'ت',
      'u': 'و', 'v': 'ڤ', 'w': 'و', 'x': 'کس', 'y': 'ي', 'z': 'ز'
      // Add more mappings for vowels, diacritics, and special characters as needed
    };
    let jawiText = '';
    for (let char of text.toLowerCase()) {
      jawiText += jawiMapping[char] || char; // Use mapping if available, otherwise keep original char
    }
    return jawiText;
  }

  document.querySelectorAll(".language-option").forEach(option => {
    option.addEventListener("click", async (e) => {
      e.preventDefault();
      const lang = option.getAttribute("data-lang");
      await updateTranslations(lang);
    });
  });
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en" class="scroll-smooth group" data-sidebar="brand" dir="ltr">
<head>
    <meta charset="utf-8" />
    <title>ThriftHub Malaysia | Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta content="Add product | Thrifthub" name="description"/>
    <meta content="" name="Mannatthemes" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- App favicon -->
    <link rel="shortcut icon" href="assets/images/favicon.ico" />
    
    <!-- Css -->
    <link rel="stylesheet" href="assets/libs/filepond/filepond.min.css">
    <link rel="stylesheet" href="assets/libs/filepond-plugin-image-preview/filepond-plugin-image-preview.min.css">
    <link rel="stylesheet" href="assets/libs/vanillajs-datepicker/css/datepicker.min.css">
    <link rel="stylesheet" href="assets/libs/mobius1-selectr/selectr.min.css">
    <!-- Main Css -->
    <link rel="stylesheet" href="assets/libs/icofont/icofont.min.css">
    <link href="assets/libs/flatpickr/flatpickr.min.css" type="text/css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/tailwind.min.css">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-storage.js"></script>
    <script src="/admin-staff/dist-admin/assets/js/script.js"></script>

    <!-- Custom CSS for additional styling -->
    <style>
        /* Custom styles for the form */
        .form-container {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        .form-input {
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 10px;
            width: 100%;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            border-color: #3b82f6;
            outline: none;
        }

        .form-label {
            font-weight: 500;
            color: #4a5568;
            margin-bottom: 8px;
            display: block;
        }

        .form-button {
            background-color: #3b82f6;
            color: #ffffff;
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .form-button:hover {
            background-color: #2563eb;
        }

        .form-button-secondary {
            background-color: transparent;
            color: #3b82f6;
            border: 1px solid #3b82f6;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .form-button-secondary:hover {
            background-color: #3b82f6;
            color: #ffffff;
        }

        .filepond-container {
            border: 2px dashed #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background-color: #f7fafc;
        }

        .filepond-container:hover {
            border-color: #3b82f6;
        }

        .preview-image {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 10px;
        }

        /* Message div styling */
        #message {
            margin-top: 10px;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-weight: 500;
        }

        #message.success {
            background-color: #d1fae5;
            color: #065f46;
        }

        #message.error {
            background-color: #fee2e2;
            color: #dc2626;
        }
    </style>
</head>

<body data-layout-mode="light" data-sidebar-size="default" data-theme-layout="vertical" class="bg-[#EEF0FC] dark:bg-gray-900">
    <!-- Left sidebar and top navigation code remain unchanged -->

    <div class="ltr:flex flex-1 rtl:flex-row-reverse">
        <div class="page-wrapper relative ltr:ms-auto rtl:me-auto rtl:ms-0 w-[calc(100%-260px)] px-4 pt-[64px] duration-300">
            <div class="xl:w-full">        
                <div class="flex flex-wrap">
                    <div class="flex items-center py-4 w-full">
                        <div class="w-full">                    
                            <div class="">
                                <div class="flex flex-wrap justify-between">
                                    <div class="items-center">
                                        <h1 class="font-medium text-3xl block dark:text-slate-100">Add Product</h1>
                                        <ol class="list-reset flex text-sm">
                                            <li><a href="#" class="text-gray-500 dark:text-slate-400">ThriftHub Malaysia</a></li>
                                            <li><span class="text-gray-500 dark:text-slate-400 mx-2">/</span></li>
                                            <li class="text-gray-500 dark:text-slate-400">Admin</li>
                                            <li><span class="text-gray-500 dark:text-slate-400 mx-2">/</span></li>
                                            <li class="text-primary-500 hover:text-primary-600 dark:text-primary-400">Add Product</li>
                                        </ol>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="today-date leading-5 mt-2 lg:mt-0 form-input w-auto rounded-md border inline-block border-primary-500/60 dark:border-primary-500/60 text-primary-500 bg-transparent px-3 py-1 focus:outline-none focus:ring-0 placeholder:text-slate-400/70 placeholder:font-normal placeholder:text-sm hover:border-primary-400 focus:border-primary-500 dark:focus:border-primary-500  dark:hover:border-slate-700">
                                            <input type="text" class="dash_date border-0 focus:border-0 focus:outline-none" readonly required="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div><!--end container-->
        
            <div class="xl:w-full min-h-[calc(100vh-138px)] relative pb-14"> 
                <div class="grid grid-cols-12 sm:grid-cols-12 md:grid-cols-12 lg:grid-cols-12 xl:grid-cols-12 gap-4 justify-between">
                    <div class="col-span-12 sm:col-span-12 md:col-span-12 lg:col-span-3 xl:col-span-3">
                        <div class="w-full relative p-4 form-container"> 
                            <label for="" class="form-label">Upload Image</label>
                            <div class="w-full h-56 mx-auto mb-4 filepond-container">
                                <input type="file" class="filepond h-56" name="filepond" accept="image/png, image/jpeg, image/gif" />                                    
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <div class="col-span-1">
                                    <input type="file" class="filepond"/>
                                </div>
                                <div class="col-span-1">
                                    <input type="file" class="filepond"/>
                                </div>
                            </div>
                        </div><!--end card-->                                  
                    </div><!--end col-->  
                    <div class="col-span-12 sm:col-span-12 md:col-span-12 lg:col-span-6 xl:col-span-6">
                        <form id="productForm" class="w-full relative mb-4 form-container">  
                            <div class="flex-auto p-0 md:p-4">                                   
                                <div class="mb-4">
                                    <label for="title" class="form-label">Title</label>
                                    <input type="text" id="title" class="form-input" placeholder="Title" required>
                                </div>
                                <div class="mb-4">
                                    <label for="category" class="form-label">Category</label>
                                    <select id="category" class="form-input" required>
                                        <option value="">Select Category</option>
                                        <option value="Electronics">Electronics</option>
                                        <option value="Furniture">Furniture</option>
                                        <option value="Footwear">Footwear</option>
                                        <option value="Clothes">Clothes</option>
                                    </select>
                                </div>
                                <div class="mb-4">
                                    <label for="description" class="form-label">Description</label>
                                    <textarea id="description" rows="3" class="form-input" placeholder="Description ..." required></textarea>
                                </div>
                                <div class="mb-4">
                                    <div class="grid grid-cols-2 gap-3">
                                        <div class="col-span-1">
                                            <label for="Product-date" class="form-label">Product Date</label>
                                            <input type="text" id="Product-date" class="form-input" name="foo" required>
                                        </div>
                                        <div class="col-span-1">
                                            <label for="price" class="form-label">Price</label>
                                            <input type="number" id="price" class="form-input" placeholder="Price" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-4">
                                    <label for="gender" class="form-label">For this product</label>
                                    <select id="gender" class="form-input" required>
                                        <option value="">-- Gender --</option>
                                        <option value="Men">Men</option>
                                        <option value="Women">Women</option>
                                        <option value="Kids">Kids</option>
                                    </select>                                       
                                </div>
                                <div class="mb-4">
                                    <label for="sizing" class="form-label">Size</label>
                                    <select id="sizing" class="form-input" required>
                                        <option value="">Size</option>
                                        <option value="S">S</option>
                                        <option value="M">M</option>
                                        <option value="L">L</option>
                                        <option value="XL">XL</option>
                                        <option value="XXL">XXL</option>
                                    </select>
                                </div>

                                <!-- Message Div for Success/Error Messages -->
                                <div id="message"></div>

                                <div class="flex gap-2">
                                    <button type="submit" class="form-button">Add Product</button>
                                    <button type="button" class="form-button-secondary">Save Product</button>
                                </div>
                            </div><!--end card-body--> 
                        </form><!--end card-->                                  
                    </div><!--end col-->  
                    <div class="col-span-12 sm:col-span-12 md:col-span-12 lg:col-span-3 xl:col-span-3">
                        <div class="w-full relative mb-4 form-container">  
                            <div class="flex-auto p-0 md:p-4">                                   
                                <div>
                                    <p class="text-slate-700 text-base dark:text-slate-400">Product Image</p>
                                    <img src="assets/images/products/pro-3.png" alt="" class="preview-image">                                    
                                </div>
                                <div class="mb-5">
                                    <p class="text-slate-700 text-base dark:text-slate-400">Product Title</p>
                                    <h4 class="text-xl font-semibold text-slate-700 dark:text-slate-300">Mannat HD, Smart LED Fire TV</h4>
                                </div>
                                <div class="mb-5">
                                    <p class="text-slate-600 text-base dark:text-slate-400">Description</p>
                                    <h4 class="text-base font-medium text-slate-900 dark:text-slate-300">It is a long established fact that a reader will be distracted by the readable content of a page when looking at its layout.</h4>
                                </div>
                                <div class="mb-5">
                                    <p class="text-slate-600 text-base dark:text-slate-400">Pro. Date</p>
                                    <h4 class="text-base font-semibold text-slate-900 dark:text-slate-300">02/05/2023</h4>
                                </div>
                                <div class="mb-5">
                                    <p class="text-slate-600 text-base dark:text-slate-400">For this product</p>1
                                    <h4 class="text-base font-semibold text-slate-900 dark:text-slate-300">Other</h4>
                                </div>
                                <div class="mb-5">
                                    <p class="text-slate-600 text-base dark:text-slate-400">Size</p>
                                    <h4 class="text-base font-semibold text-slate-900 dark:text-slate-300">SM, MD, LG, XL</h4>
                                </div>
                            </div><!--end card-body--> 
                        </div><!--end card-->                                  
                    </div><!--end col-->                        
                </div> <!--end grid-->                                        
                <!-- footer -->
                <div class="absolute bottom-0 -left-4 -right-4 block print:hidden border-t p-4 h-[52px] dark:border-slate-700/40">
                    <div class="container">
                        <!-- Footer Start -->
                        <footer class="footer bg-transparent text-center font-medium text-slate-600 dark:text-slate-400 md:text-left">
                            &copy;
                            <script>
                                var year = new Date();document.write(year.getFullYear());
                            </script>
                            ThriftHub Malaysia
                            <span class="float-right hidden text-slate-600 dark:text-slate-400 md:inline-block">Crafted with <i class="ti ti-heart text-red-500"></i> by YUYIN</span>
                        </footer>
                        <!-- end Footer -->
                    </div>
                </div>
            </div><!--end container-->
        </div><!--end page-wrapper-->
    </div><!--end /div-->

    <!-- JAVASCRIPTS -->
    <script src="assets/libs/lucide/umd/lucide.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/flatpickr/flatpickr.min.js"></script>
    <script src="assets/libs/@frostui/tailwindcss/frostui.js"></script>

    <script src="assets/libs/filepond/filepond.min.js"></script>
    <script src="assets/libs/filepond-plugin-image-preview/filepond-plugin-image-preview.min.js"></script>
    <script src="assets/libs/vanillajs-datepicker/js/datepicker-full.min.js"></script>
    <script src="assets/libs/mobius1-selectr/selectr.min.js"></script>
    <script src="assets/js/app.js"></script>

    <!-- Firebase Initialization and Form Submission Logic -->
    <script type="module">
      import { db, storage } from './firebase-config.js'; // Import Firebase services
    
      // Initialize FilePond
      FilePond.registerPlugin(FilePondPluginImagePreview);
      const inputElement = document.querySelectorAll('input[type="file"]');
      inputElement.forEach(element => {
          const pond = FilePond.create(element);
      });
    
      // Form Submission Logic
      document.addEventListener('DOMContentLoaded', function() {
          const productForm = document.getElementById('productForm');
          const messageDiv = document.getElementById('message');
          
          productForm.addEventListener('submit', async (e) => {
              e.preventDefault();
              
              try {
                  // Get form values
                  const title = document.getElementById('title').value;
                  const price = parseFloat(document.getElementById('price').value);
                  const category = document.getElementById('category').value;
                  const description = document.getElementById('description').value;
                  const productDate = document.getElementById('Product-date').value;
                  const gender = document.getElementById('gender').value;
                  const size = document.getElementById('sizing').value;

                  // Get the main image file from FilePond
                  const mainImagePond = FilePond.find(document.querySelector('.filepond'));
                  const mainImageFile = mainImagePond.getFiles()[0]?.file;

                  // Show loading message
                  messageDiv.textContent = 'Uploading product...';
                  messageDiv.className = '';

                  let imageUrl = '';
                  if (mainImageFile) {
                      // Upload image to Firebase Storage
                      const storageRef = storage.ref(`products/${Date.now()}_${mainImageFile.name}`);
                      const snapshot = await storageRef.put(mainImageFile);
                      imageUrl = await snapshot.ref.getDownloadURL();
                  }

                  // Add product to Firestore
                  await db.collection('products').add({
                      title: title,
                      price: price,
                      category: category,
                      description: description,
                      productDate: productDate,
                      gender: gender,
                      size: size,
                      imageUrl: imageUrl,
                      createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                      status: 'available'
                  });

                  // Success message and reset form
                  messageDiv.textContent = 'Product added successfully!';
                  messageDiv.className = 'success';
                  productForm.reset();

                  // Clear message after 3 seconds
                  setTimeout(() => {
                      messageDiv.textContent = '';
                      messageDiv.className = '';
                  }, 3000);

              } catch (error) {
                  console.error('Error adding product:', error);
                  messageDiv.textContent = 'Error adding product: ' + error.message;
                  messageDiv.className = 'error';
              }
          });
      });
    </script>
</body>
</html>